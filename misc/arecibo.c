// ./a.out | ffmpeg -ar 16000 -f s16le -acodec pcm_f32le -i - arecibo.wav
// Adapted Arecibo message, Manchester code, AFSK

#include <math.h>
#include <stdint.h>
#include <stdio.h>

static const char msg[] =
"00000010101010000000000"
"00101000001010000000100"
"10001000100010010110010"
"10101010101010100100100"
"00000000000000000000000"
"00000000000011000000000"
"00000000001101000000000"
"00000000001101000000000"
"00000000010101000000000"
"00000000011111000000000"
"00000000000000000000000"
"11000011100011000011000"
"10000000000000110010000"
"11010001100011000011010"
"11111011111011111011111"
"00000000000000000000000"
"00010000000000000000010"
"00000000000000000000000"
"00001000000000000000001"
"11111000000000000011111"
"00000000000000000000000"
"11000011000011100011000"
"10000000100000000010000"
"11010000110001110011010"
"11111011111011111011111"
"00000000000000000000000"
"00010000000100000000010"
"00000000000000000000000"
"00001000001100000000001"
"11111000001100000011111"
"00000000001100000000000"
"00100000001000000000100"
"00010000001000000001000"
"00001100001000000010000"
"00000011000100001100000"
"00000000000100110000000"
"00000011000000001100000"
"00001100000000000010000"
"00010000000000000001000"
"00100000000100000000100"
"01000000000100000000100"
"01000000000000000001000"
"00100000001000000010000"
"00010000000000001100000"
"00001100000000110000000"
"00100011101011000000000"
"00100000001000000000000"
"00100000111110000000000"
"00100001011101001000001"
"00000010011100100001000"
"01110000011100000010111"
"00000000010100000100110"
"00100000010100000001001"
"00100000010100000111000"
"00100000110110000000000"
"00000000000000000000000"
"00111000001000000000000"
"00111010100010101010101"
"00111000000000101010100"
"00000000000000101000000"
"00000000111110000000000"
"00000011111111100000000"
"00001110000000111000000"
"00011000000000001100000"
"00110100000000010110000"
"01100110000000110011000"
"01000101000001010001000"
"01000100100010010001000"
"00000100010100010000000"
"00000100001000010000000"
"00000100000000010000000"
"00000000100000000000000"
"01111000111001001111000"
;

static const int Fs = 16000;
static const int T = Fs / 20;   // 20 Bd
static const float w0 = 575.f / Fs * (float)M_PI * 2;
static const float w1 = 625.f / Fs * (float)M_PI * 2;

int main()
{
  float t = 0;
  for (const char *s = msg; *s; s++) {
    for (int n = 0; n < T; n++) {
      t += ((*s == '0') ^ (n >= T / 2) ? w0 : w1);
      if (t >= (float)M_PI * 2) t -= (float)M_PI * 2;
      float x = sinf(t) * 0.1f;
      uint32_t xi = *(uint32_t *)&x;
      putchar((xi >>  0) & 0xff);
      putchar((xi >>  8) & 0xff);
      putchar((xi >> 16) & 0xff);
      putchar((xi >> 24) & 0xff);
    }
  }

  return 0;
}
